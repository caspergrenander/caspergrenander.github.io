<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AutoPublisher – Upload Interface</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: #000;
  color: #FFFFFF;
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
  line-height: 1.6;
}

header {
  padding: 60px 20px 40px;
  text-align: center;
  background: #111;
  border-bottom: 1px solid #F5B04133;
  box-shadow: 0 0 15px rgba(245,176,65,0.15);
}

header a {
  color: inherit;
  text-decoration: none;
  display: inline-block;
}

header img {
  width: 180px;
  border-radius: 6px;
  margin-bottom: 20px;
}

h1 {
  color: #F5B041;
  text-transform: uppercase;
  font-weight: 700;
}

.container {
  max-width: 900px;
  margin: 50px auto;
  background: #111;
  padding: 40px 30px;
  border-radius: 10px;
  border: 1px solid #F5B04122;
  text-align: center;
}

.ui-box {
  margin-top: 30px;
  padding: 25px;
  border: 1px dashed #333;
  border-radius: 8px;
}

textarea {
  width: 100%;
  min-height: 80px;
  margin: 10px 0;
  padding: 12px;
  background: #000;
  color: #fff;
  border: 1px solid #333;
  border-radius: 6px;
  resize: vertical;
}

.button {
  display: inline-block;
  margin: 10px;
  padding: 14px 24px;
  font-size: 15px;
  font-weight: 600;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  background: #F5B041;
  color: #000;
}

.button.secondary {
  background: #444;
  color: #fff;
}

.button:disabled {
  background: #333;
  color: #999;
  cursor: not-allowed;
}

#status {
  margin-top: 20px;
  font-size: 14px;
  color: #9FE870;
}

.note {
  margin-top: 15px;
  font-size: 13px;
  color: #B4B4B4;
}

footer {
  margin-top: 60px;
  padding: 30px;
  text-align: center;
  font-size: 0.9rem;
  color: #B4B4B4;
  border-top: 1px solid #333;
}
</style>
</head>

<body>

<header>
  <a href="/historienbakomusiken/">
    <img src="/historienbakomusiken/historienbakomusiken/assets/logo.png">
    <h1>AutoPublisher</h1>
  </a>
  <p>Upload & Publish Interface</p>
</header>

<div class="container">

  <p>
    Users manually upload and publish videos to <strong>their own TikTok account</strong>.
    No actions are automated.
  </p>

  <div class="ui-box">

    <input type="file" id="videoFile" accept="video/*" style="display:none">

    <button class="button" id="uploadBtn">Upload Video</button>

    <textarea id="caption" placeholder="Write caption..."></textarea>
    <textarea id="hashtags" placeholder="#music #history"></textarea>

    <button class="button secondary" id="generateBtn">
      Generate caption & hashtags
    </button>

    <br>

    <button class="button" id="publishBtn" disabled>Publish now</button>
    <button class="button secondary" id="scheduleBtn" disabled>Schedule</button>

    <div id="status"></div>

    <div class="note">
      User-initiated publish or scheduling via backend service.
    </div>

  </div>
</div>

<footer>
  © 2025 Casper Grenander – Historien Bakom Musiken AutoPublisher
</footer>

<script>
let selectedFile = null;

const uploadBtn = document.getElementById("uploadBtn");
const publishBtn = document.getElementById("publishBtn");
const scheduleBtn = document.getElementById("scheduleBtn");
const generateBtn = document.getElementById("generateBtn");

uploadBtn.onclick = () => {
  document.getElementById("videoFile").click();
};

document.getElementById("videoFile").onchange = e => {
  selectedFile = e.target.files[0];
  if (selectedFile) {
    document.getElementById("status").innerText =
      "Video selected: " + selectedFile.name;
    publishBtn.disabled = false;
    scheduleBtn.disabled = false;
  }
};

generateBtn.onclick = () => {
  document.getElementById("status").innerText =
    "Generating caption & hashtags...";

  google.script.run
    .withSuccessHandler(res => {
      document.getElementById("caption").value = res.caption || "";
      document.getElementById("hashtags").value = res.hashtags || "";
      document.getElementById("status").innerText =
        "Suggestions generated.";
    })
    .withFailureHandler(err => {
      document.getElementById("status").innerText =
        "Error: " + err.message;
    })
    .generateCaptionAndHashtags();
};

function readFileAndSend(callbackName) {
  const reader = new FileReader();
  reader.onload = () => {
    google.script.run
      .withSuccessHandler(() => {
        document.getElementById("status").innerText =
          "Request sent successfully.";
      })
      .withFailureHandler(err => {
        document.getElementById("status").innerText =
          "Error: " + err.message;
      })[callbackName]({
        filename: selectedFile.name,
        mimeType: selectedFile.type,
        data: reader.result.split(",")[1],
        caption: document.getElementById("caption").value,
        hashtags: document.getElementById("hashtags").value
      });
  };
  reader.readAsDataURL(selectedFile);
}

publishBtn.onclick = () => {
  if (!selectedFile) return;
  document.getElementById("status").innerText =
    "Publishing to TikTok...";
  readFileAndSend("publishToTikTok");
};

scheduleBtn.onclick = () => {
  if (!selectedFile) return;
  document.getElementById("status").innerText =
    "Saving to scheduler queue...";
  readFileAndSend("saveToSchedulerQueue");
};
</script>

</body>
</html>