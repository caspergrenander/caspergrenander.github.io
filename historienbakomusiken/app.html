<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AutoPublisher – Upload Interface</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: #1A2838;
  color: #F5E5C8;
  font-family: Arial, Helvetica, sans-serif;
  line-height: 1.7;
}

header {
  padding: 60px 20px 40px;
  text-align: center;
  background: #0D0F15;
  border-bottom: 1px solid #2A4A4A;
}

header a {
  color: inherit;
  text-decoration: none;
  display: inline-block;
}

header img {
  width: 180px;
  border-radius: 4px;
  margin-bottom: 18px;
}

h1 {
  color: #FFFFFF;
  margin-bottom: 8px;
  font-weight: 600;
  text-transform: uppercase;
}

h2 {
  color: #FFFFFF;
  font-weight: 600;
  margin-top: 50px;
}

p {
  max-width: 800px;
  margin: 10px auto;
  padding: 0 20px;
  color: #F5E5C8;
  font-size: 15px;
}

a {
  color: #E8B65C;
  text-decoration: none;
}
a:hover {
  text-decoration: underline;
}

.container {
  max-width: 900px;
  margin: 40px auto;
  background: #0D0F15;
  padding: 40px 30px;
  border-radius: 6px;
  border: 1px solid #2A4A4A;
}

ul {
  max-width: 800px;
  margin: auto;
  padding-left: 40px;
}

code {
  background: #1A2838;
  color: #E8B65C;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 13px;
}

footer {
  margin-top: 60px;
  padding: 30px;
  text-align: center;
  font-size: 12px;
  color: #2A4A4A;
  border-top: 1px solid #2A4A4A;
}
</style>
</head>

<body>

<header>
  <a href="/historienbakomusiken/">
    <img src="/historienbakomusiken/historienbakomusiken/assets/logo.png">
    <h1>AutoPublisher</h1>
  </a>
  <p>Upload & Publish Interface</p>
</header>

<div class="container">

  <p>
    Users manually upload and publish videos to <strong>their own TikTok account</strong>.
    No actions are automated.
  </p>

  <div class="ui-box">

    <input type="file" id="videoFile" accept="video/*" style="display:none">

    <button class="button" id="uploadBtn">Upload Video</button>

    <textarea id="caption" placeholder="Write caption..."></textarea>
    <textarea id="hashtags" placeholder="#music #history"></textarea>

    <button class="button secondary" id="generateBtn">
      Generate caption & hashtags
    </button>

    <br>

    <button class="button" id="publishBtn" disabled>Publish now</button>
    <button class="button secondary" id="scheduleBtn" disabled>Schedule</button>

    <div id="status"></div>

    <div class="note">
      User-initiated publish or scheduling via backend service.
    </div>

  </div>
</div>

<footer>
  © 2025 Casper Grenander – Historien Bakom Musiken AutoPublisher
</footer>

<script>
let selectedFile = null;

const uploadBtn = document.getElementById("uploadBtn");
const publishBtn = document.getElementById("publishBtn");
const scheduleBtn = document.getElementById("scheduleBtn");
const generateBtn = document.getElementById("generateBtn");

uploadBtn.onclick = () => {
  document.getElementById("videoFile").click();
};

document.getElementById("videoFile").onchange = e => {
  selectedFile = e.target.files[0];
  if (selectedFile) {
    document.getElementById("status").innerText =
      "Video selected: " + selectedFile.name;
    publishBtn.disabled = false;
    scheduleBtn.disabled = false;
  }
};

generateBtn.onclick = () => {
  document.getElementById("status").innerText =
    "Generating caption & hashtags...";

  google.script.run
    .withSuccessHandler(res => {
      document.getElementById("caption").value = res.caption || "";
      document.getElementById("hashtags").value = res.hashtags || "";
      document.getElementById("status").innerText =
        "Suggestions generated.";
    })
    .withFailureHandler(err => {
      document.getElementById("status").innerText =
        "Error: " + err.message;
    })
    .generateCaptionAndHashtags();
};

function readFileAndSend(callbackName) {
  const reader = new FileReader();
  reader.onload = () => {
    google.script.run
      .withSuccessHandler(() => {
        document.getElementById("status").innerText =
          "Request sent successfully.";
      })
      .withFailureHandler(err => {
        document.getElementById("status").innerText =
          "Error: " + err.message;
      })[callbackName]({
        filename: selectedFile.name,
        mimeType: selectedFile.type,
        data: reader.result.split(",")[1],
        caption: document.getElementById("caption").value,
        hashtags: document.getElementById("hashtags").value
      });
  };
  reader.readAsDataURL(selectedFile);
}

publishBtn.onclick = () => {
  if (!selectedFile) return;
  document.getElementById("status").innerText =
    "Publishing to TikTok...";
  readFileAndSend("publishToTikTok");
};

scheduleBtn.onclick = () => {
  if (!selectedFile) return;
  document.getElementById("status").innerText =
    "Saving to scheduler queue...";
  readFileAndSend("saveToSchedulerQueue");
};
</script>

</body>
</html>
